{"ast":null,"code":"var _jsxFileName = \"/home/jce/Web Dev Space/Syncsequence/frontEnd/src/components/map/map.jsx\",\n    _s = $RefreshSig$();\n\n/* V I T A L S */\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Map, View } from 'ol';\nimport TileLayer from 'ol/layer/Tile';\nimport OSM from 'ol/source/OSM';\nimport { fromLonLat } from 'ol/proj.js';\nimport VectorLayer from 'ol/layer/Vector';\nimport VectorSource from 'ol/source/Vector';\nimport { Point } from 'ol/geom';\nimport { Feature } from 'ol';\nimport Cluster from 'ol/source/Cluster';\nimport { Circle as CircleStyle, Fill, Stroke, Style, Text } from 'ol/style';\nimport Control from 'ol/control/Control';\nimport Header from '../../components/base/header';\nimport { useNavigate } from 'react-router-dom';\nimport APIaccess from '../../apiaccess';\nimport Log from '../blog/log';\nimport 'ol/ol.css';\nimport './map.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet accessAPI = APIaccess();\n\nfunction CenterIcon(_ref) {\n  let {} = _ref;\n  return /*#__PURE__*/_jsxDEV(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"20.5\",\n    height: \"21.11\",\n    viewBox: \"0 0 20.706 21.11\",\n    children: /*#__PURE__*/_jsxDEV(\"g\", {\n      id: \"Group_343\",\n      \"data-name\": \"Group 343\",\n      transform: \"translate(1584 -5877)\",\n      children: [/*#__PURE__*/_jsxDEV(\"g\", {\n        id: \"Ellipse_27\",\n        \"data-name\": \"Ellipse 27\",\n        transform: \"translate(-1580.482 5880.519)\",\n        fill: \"none\",\n        stroke: \"rgba(0,0,0,0.4)\",\n        \"stroke-width\": \"2\",\n        children: [/*#__PURE__*/_jsxDEV(\"circle\", {\n          cx: \"7.037\",\n          cy: \"7.037\",\n          r: \"7.037\",\n          stroke: \"none\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n          cx: \"7.037\",\n          cy: \"7.037\",\n          r: \"6.037\",\n          fill: \"none\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 37,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n        id: \"Line_206\",\n        \"data-name\": \"Line 206\",\n        y1: \"3.518\",\n        transform: \"translate(-1573.445 5877)\",\n        fill: \"none\",\n        stroke: \"rgba(0,0,0,0.4)\",\n        \"stroke-width\": \"2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n        id: \"Line_207\",\n        \"data-name\": \"Line 207\",\n        y1: \"3.451\",\n        transform: \"translate(-1563.294 5887.354) rotate(90)\",\n        fill: \"none\",\n        stroke: \"rgba(0,0,0,0.4)\",\n        \"stroke-width\": \"2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n        id: \"Line_208\",\n        \"data-name\": \"Line 208\",\n        y1: \"3.451\",\n        transform: \"translate(-1580.549 5887.354) rotate(90)\",\n        fill: \"none\",\n        stroke: \"rgba(0,0,0,0.4)\",\n        \"stroke-width\": \"2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n        id: \"Line_209\",\n        \"data-name\": \"Line 209\",\n        y1: \"3.518\",\n        transform: \"translate(-1573.445 5894.592)\",\n        fill: \"none\",\n        stroke: \"rgba(0,0,0,0.4)\",\n        \"stroke-width\": \"2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 29,\n    columnNumber: 3\n  }, this);\n}\n\n_c = CenterIcon;\n\nfunction ArrowIcon(_ref2) {\n  let {\n    classname\n  } = _ref2;\n  return /*#__PURE__*/_jsxDEV(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"25.624\",\n    height: \"7.866\",\n    viewBox: \"0 0 25.624 7.866\",\n    className: `${classname}`,\n    children: /*#__PURE__*/_jsxDEV(\"g\", {\n      id: \"Group_224\",\n      \"data-name\": \"Group 224\",\n      transform: \"translate(-22 -25.634)\",\n      children: [/*#__PURE__*/_jsxDEV(\"line\", {\n        fill: \"none\",\n        stroke: \"rgba(0,0,0,0.4)\",\n        \"stroke-width\": \"2\",\n        id: \"Line_146\",\n        \"data-name\": \"Line 146\",\n        class: \"cls-1\",\n        x2: \"25\",\n        transform: \"translate(22.624 32.5)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n        fill: \"none\",\n        stroke: \"rgba(0,0,0,0.4)\",\n        \"stroke-width\": \"2\",\n        id: \"Line_148\",\n        \"data-name\": \"Line 148\",\n        class: \"cls-1\",\n        x2: \"12\",\n        transform: \"translate(22.5 32.5) rotate(-30)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 50,\n    columnNumber: 3\n  }, this);\n}\n\n_c2 = ArrowIcon;\nexport default function MapComponent(_ref3) {\n  _s();\n\n  let {\n    setCurrent,\n    current,\n    log,\n    setLog,\n    selectedDate,\n    setSelectedDate,\n    cal,\n    setSocketMessage\n  } = _ref3;\n  const navigate = useNavigate();\n  const [mapState, setMapState] = React.useState(null);\n  const [currentCenter, setCurrentCenter] = React.useState([sessionStorage.getItem('settings_preferredLocation_lon'), sessionStorage.getItem('settings_preferredLocation_lat')]);\n  const [markers, setMarkers] = React.useState([// { \n    // \tid: 1, \n    // \tcoords: [-73.9249, 40.6943], \n    // \ttitle: 'First Spot',\n    // \ttext: 'This is just some filler text to place within this pop up element that we have here. No important information relevant to anything.' \n    // },\n    // { \t\n    // \tid: 2, \n    // \tcoords: [-73.935242, 40.730610], \n    // \ttitle: 'Second Spot',\n    // \ttext: 'These are some words that the dev would like to place here as filler content. It is of no importance or effect to anything'\n    // }\n  ]);\n  const mapRef = React.useRef();\n  const [isMapMounted, setMapMounted] = React.useState(false);\n  const [postBoardInfo, setPostBoardInfo] = React.useState({\n    title: null,\n    text: null\n  });\n  const [postBoardClass, setPostBoardClass] = React.useState('down'); //up or down\n\n  const [headerState, setHeaderState] = React.useState('allPosts'); //allPosts, date or macros\n\n  const [dateSelect, setDateSelect] = React.useState({\n    open: false,\n    month: null,\n    year: null,\n    date: null\n  });\n  /* \r\n  \tExtracts data from log for markers and popUpPanel\r\n     \tand Filters posts based on headerState \r\n  */\n\n  React.useEffect(() => {\n    if (headerState == 'allPosts') {\n      let num = 0;\n      let locations = log.filter(entry => entry.hasOwnProperty('location')).map(entry => {\n        let text;\n\n        if (entry.content.find(data => data.type == 'text')) {\n          text = entry.content.find(data => data.type == 'text');\n        }\n\n        return {\n          id: num,\n          coords: [parseFloat(entry.location.lon), parseFloat(entry.location.lat)],\n          title: entry.title,\n          text: text != undefined ? text.content : null,\n          tags: entry.tags ? entry.tags.length : null,\n          taggedUsers: entry.taggedUsers ? entry.taggedUsers.length : null,\n          comments: entry.commentCount,\n          postData: entry\n        };\n        num++;\n      });\n      setMarkers(locations);\n    }\n\n    if (headerState == 'date') {\n      let num = 0;\n      let locations = log.filter(entry => {\n        if (entry.hasOwnProperty('location')) {\n          if (entry.postedOn_month == dateSelect.month && entry.postedOn_day == dateSelect.date && entry.postedOn_year == dateSelect.year) {\n            return entry;\n          }\n        }\n      }).map(entry => {\n        return {\n          id: num,\n          // coords: points,\n          coords: [parseFloat(entry.location.lon), parseFloat(entry.location.lat)],\n          title: entry.title,\n          text: entry.content[0].content,\n          tags: entry.tags ? entry.tags.length : null,\n          taggedUsers: entry.taggedUsers ? entry.taggedUsers.length : null,\n          comments: entry.commentCount,\n          postData: entry\n        };\n        num++;\n      });\n      setMarkers(locations);\n    }\n  }, [headerState, dateSelect]);\n  /*  T H E   M A P\r\n  \tRenders Open Layers Map on Component Mount */\n\n  React.useEffect(() => {\n    const customStyle = {\n      'background-color': '#f2efe9',\n      'roads': {\n        'major': {\n          color: '#34495e',\n          width: 2\n        },\n        'minor': {\n          color: '#7f8c8d',\n          width: 1\n        },\n        'highway': {\n          color: '#e74c3c',\n          width: 3\n        }\n      },\n      'water': {\n        fill: '#3498db',\n        stroke: '#2980b9'\n      },\n      'parks': {\n        fill: '#2ecc71',\n        stroke: '#27ae60'\n      },\n      'buildings': {\n        fill: '#95a5a6',\n        stroke: '#7f8c8d'\n      },\n      'labels': {\n        'city': {\n          color: '#2c3e50',\n          size: '14px',\n          weight: 'bold',\n          halo: {\n            color: '#ffffff',\n            width: 2\n          }\n        },\n        'town': {\n          color: '#34495e',\n          size: '12px',\n          weight: 'normal',\n          halo: {\n            color: '#ffffff',\n            width: 1\n          }\n        },\n        'poi': {\n          color: '#8e44ad',\n          size: '11px',\n          weight: 'normal',\n          halo: {\n            color: '#ffffff',\n            width: 1\n          }\n        }\n      },\n      'boundaries': {\n        'administrative': {\n          color: '#bdc3c7',\n          width: 1,\n          dash: [4, 4] // Creates a dashed line\n\n        },\n        'country': {\n          color: '#7f8c8d',\n          width: 2\n        }\n      },\n      'landuse': {\n        'residential': '#ecf0f1',\n        'commercial': '#e8e0d8',\n        'industrial': '#dad5d2',\n        'agricultural': '#dcedc8'\n      },\n      'terrain': {\n        'contour': '#b39ddb',\n        'hillshade': '#000000',\n        'hillshadeOpacity': 0.1\n      }\n    };\n\n    const createTextStyle = feature => {\n      const labelType = feature.get('labelType') || 'city';\n      const labelStyle = customStyle.labels[labelType];\n      return new Text({\n        text: feature.get('name'),\n        font: `${labelStyle.weight} ${labelStyle.size} Arial`,\n        fill: new Fill({\n          color: labelStyle.color\n        }),\n        stroke: new Stroke({\n          color: labelStyle.halo.color,\n          width: labelStyle.halo.width\n        }),\n        overflow: true,\n        offsetY: -15\n      });\n    };\n\n    let centerCoordinates = fromLonLat(currentCenter); //Creates necessary layer for adding circle spots on map\n\n    const vectorSource = new VectorSource(); //create vector layer with vectorSource\n\n    const vectorLayer = new VectorLayer({\n      source: vectorSource\n    });\n    const clusterSource = new Cluster({\n      distance: 40,\n      source: vectorSource\n    });\n    const clusterLayer = new VectorLayer({\n      source: clusterSource,\n      style: feature => {\n        const size = feature.get('features').length;\n\n        if (size > 1) {\n          return new Style({\n            image: new CircleStyle({\n              radius: 18,\n              // larger radius for clusters\n              fill: new Fill({\n                color: 'rgba(0, 82, 255, 0.5)'\n              }),\n              stroke: new Stroke({\n                color: 'white',\n                width: 2\n              })\n            }),\n            text: new Text({\n              text: size > 1 ? size.toString() : '',\n              // show the number of posts in the cluster\n              font: '300 16px Raleway',\n              fill: new Fill({\n                color: 'transparent'\n              }),\n              stroke: new Stroke({\n                color: 'white',\n                width: 2\n              })\n            })\n          });\n        } else {\n          return new Style({\n            image: new CircleStyle({\n              radius: 10,\n              fill: new Fill({\n                color: 'rgba(0, 82, 255, 0.5)'\n              }),\n              stroke: new Stroke({\n                color: 'white',\n                width: 2\n              })\n            })\n          });\n        }\n      }\n    }); //creates markers from coordinates, adds them to VectorSource\n\n    markers.forEach(marker => {\n      let spot = new Feature({\n        geometry: new Point(fromLonLat(marker.coords)),\n        data: marker\n      });\n      spot.setStyle(new Style({\n        image: new CircleStyle({\n          radius: 8,\n          fill: new Fill({\n            color: 'grey'\n          }),\n          stroke: new Stroke({\n            color: 'white',\n            width: 2\n          })\n        })\n      }));\n      vectorSource.addFeature(spot);\n      clusterSource.addFeature(spot);\n    }); // Create a custom Zoom In button control\n\n    class ZoomInControl extends Control {\n      constructor(opt_options) {\n        const options = opt_options || {}; // Create a button element\n\n        const button = document.createElement('button');\n        button.id = 'zoomIn';\n        button.innerHTML = '+'; // Create a div element to wrap the button\n\n        const element = document.createElement('div');\n        element.className = 'zoom-in-button ol-unselectable ol-control';\n        element.appendChild(button);\n        super({\n          element: element,\n          target: options.target\n        });\n        button.addEventListener('click', () => {\n          const view = initialMap.getView();\n          const zoom = view.getZoom();\n          view.animate({\n            zoom: zoom + 1,\n            duration: 500\n          });\n        });\n      }\n\n    } // Create a custom Zoom Out button control (bottom-left)\n\n\n    class ZoomOutControl extends Control {\n      constructor(opt_options) {\n        const options = opt_options || {}; // Create a button element\n\n        const button = document.createElement('button');\n        button.id = 'zoomOut';\n        button.innerHTML = '-'; // Create a div element to wrap the button\n\n        const element = document.createElement('div');\n        element.className = 'zoom-out-button ol-unselectable ol-control'; // Position it at the bottom-left\n\n        element.appendChild(button);\n        super({\n          element: element,\n          target: options.target\n        });\n        button.addEventListener('click', () => {\n          const view = initialMap.getView();\n          const zoom = view.getZoom();\n          view.animate({\n            zoom: zoom - 1,\n            duration: 500\n          });\n        });\n      }\n\n    } // Create a custom \"Recenter\" button control\n\n\n    class RecenterControl extends Control {\n      constructor(opt_options) {\n        const options = opt_options || {}; // Create a button element\n\n        const button = document.createElement('button');\n        button.id = 'recenter'; // Create a div element to wrap the button\n\n        const element = document.createElement('div');\n        element.className = 'recenter-button ol-unselectable ol-control';\n        element.appendChild(button);\n        super({\n          element: element,\n          target: options.target\n        });\n        ReactDOM.render( /*#__PURE__*/_jsxDEV(CenterIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 426,\n          columnNumber: 26\n        }, void 0), button); // Handle the button click event\n\n        button.addEventListener('click', this.handleRecenter.bind(this), false);\n      }\n\n      handleRecenter() {\n        // Animate the map to recenter on the initial coordinates\n        const view = initialMap.getView();\n        view.animate({\n          center: fromLonLat(currentCenter),\n          zoom: 11,\n          duration: 500\n        });\n      }\n\n    } //create OSM / Tile layer\n\n\n    const osmLayer = new TileLayer({\n      preload: Infinity,\n      source: new OSM()\n    });\n    const initialMap = new Map({\n      target: mapRef.current,\n      layers: [osmLayer, clusterLayer],\n      view: new View({\n        center: centerCoordinates,\n        //lat n lng\n        zoom: 11,\n        maxZoom: 15\n      })\n    });\n    initialMap.on('click', event => {\n      initialMap.forEachFeatureAtPixel(event.pixel, feature => {\n        const clickedCoords = feature.getGeometry().getCoordinates(); // let data = feature.get('data');\n\n        const features = feature.get('features');\n\n        if (features.length > 1) {\n          //if multiple posts\n          const postData = features.map(f => f.get('data'));\n          setPostInfo(postData);\n        } else {\n          const data = features[0].get('data');\n          setPostInfo([data]);\n        }\n\n        setPostBoardClass('down'); // let secondStep = setTimeout(()=> {\n        // \tsetPostBoardInfo(data)\n        // }, 600);\n\n        let thirdStep = setTimeout(() => {\n          setPostBoardClass('up');\n        }, 1000);\n        initialMap.getView().animate({\n          center: clickedCoords,\n          zoom: 14,\n          duration: 750\n        });\n      });\n    });\n    initialMap.addControl(new RecenterControl());\n    initialMap.addControl(new ZoomInControl());\n    initialMap.addControl(new ZoomOutControl());\n    setMapState(initialMap); //Removes map on unmount\n\n    return () => {\n      // if(initialMap) {\n      initialMap.setTarget(null); // Remove event listeners\n      // initialMap.un('click', clickListener);\n      // Remove controls (if dynamically added)\n      // initialMap.getControls().clear();\n      //Detachs map from the DOM\n      // initialMap.setTarget(null);\n      //Clears the vector layer\n      // vectorSource.clear()\n      // }\t\t\n    };\n  }, [currentCenter, markers, isMapMounted]);\n\n  function openPopupWithPosts(posts) {\n    setPostInfo(posts);\n    setCurrentPostIndex(0);\n    setPostBoardClass('down');\n    setTimeout(() => setPostBoardClass('up'), 1000);\n  }\n\n  function openPopupWithSinglePost(post) {\n    setPostInfo([post]);\n    setCurrentPostIndex(0);\n    setPostBoardClass('down');\n    setTimeout(() => setPostBoardClass('up'), 1000);\n  }\n\n  function handleNextPost() {\n    setCurrentPostIndex(prevIndex => (prevIndex + 1) % postInfo.length);\n  }\n\n  function handlePrevPost() {\n    setCurrentPostIndex(prevIndex => (prevIndex - 1 + postInfo.length) % postInfo.length);\n  }\n\n  async function updatePreferredLocation(locationName, lonLat) {\n    let request = await accessAPI.userSettings({\n      option: 'updateLocation',\n      name: 'locationName',\n      lonLat: lonLat //is array\n\n    });\n\n    if (request.confirmation == true) {\n      setSocketMessage({\n        type: 'simpleNotif',\n        message: `Default Location saved to ${locationName}`\n      });\n    }\n  }\n  /* For Date Select */\n\n\n  const onChange = e => {\n    if (e.target.name == 'yearSelect') {\n      setDateSelect({ ...dateSelect,\n        year: e.target.value\n      });\n\n      if (e.target.value.length == 4) {\n        setSelectedDate({ ...selectedDate,\n          year: e.target.value\n        });\n      }\n    } else if (e.target.name == 'dateSelect') {\n      setDateSelect({ ...dateSelect,\n        date: e.target.value\n      });\n      setSelectedDate({ ...selectedDate,\n        day: e.target.value\n      });\n    }\n  };\n  /* For Map Settings */\n\n\n  const [selectedPlace, setSelectedPlace] = React.useState(null); // Only allow one selection\n\n  const [suggestions, setSuggestions] = React.useState([]);\n  const [searchTerm, setSearchTerm] = React.useState(sessionStorage.getItem('settings_preferredLocation_name') ? sessionStorage.getItem('settings_preferredLocation_name') : '');\n  const [inputType, setInputType] = React.useState(\"\");\n  const [loadingResults, setLoadingResults] = React.useState(false);\n  const inputRef = React.useRef(null);\n  const autocompleteRef = React.useRef(null);\n\n  const getLocationSuggestions = async query => {\n    try {\n      if (!query.trim()) {\n        setSuggestions([]);\n        return;\n      }\n\n      setLoadingResults(true);\n      const response = await accessAPI.userSettings({\n        option: 'searchLocation',\n        query: query\n      });\n\n      if (response.length > 0) {\n        setSuggestions(response);\n      } else {\n        throw new Error('Failed to fetch places');\n      }\n    } catch (err) {\n      console.error('Error fetching suggestions:', err); // setError(err.message);\n    } finally {\n      setLoadingResults(false);\n    }\n  };\n\n  const handleInputChange = e => {\n    const value = e.target.value;\n    setInputType(e.nativeEvent.inputType);\n    setSearchTerm(value); // if (e.nativeEvent.inputType === \"deleteContentBackward\") {\n    //     return;\n    // }\n  };\n\n  React.useEffect(() => {\n    console.log(searchTerm.length);\n\n    if (searchTerm == sessionStorage.getItem('settings_preferredLocation_name')) {\n      return;\n    }\n\n    if (inputType === \"deleteContentBackward\") {\n      return;\n    }\n\n    if (searchTerm.length < 2) {\n      console.log('empty');\n      setSuggestions([]);\n      return;\n    } // if(selectedPlace.name == searchTerm) {\n    // \treturn;\n    // }\n\n\n    getLocationSuggestions(searchTerm);\n  }, [searchTerm]);\n\n  const handleSelectSuggestion = async place => {\n    const response = await accessAPI.userSettings({\n      option: 'searchLocationDetails',\n      placeID: place.place_id\n    });\n    setSelectedPlace({\n      name: place.description,\n      lonLat: response.lonLat\n    });\n    setSuggestions([]);\n    setSearchTerm(place.description);\n    const update = await accessAPI.userSettings({\n      option: 'updateLocation',\n      name: place.description,\n      lonLat: response.lonLat\n    });\n    sessionStorage.setItem('settings_preferredLocation_lon', response.lonLat[0]);\n    sessionStorage.setItem('settings_preferredLocation_lat', response.lonLat[1]);\n    sessionStorage.setItem('settings_preferredLocation_name', place.description);\n    setSocketMessage({\n      type: 'simpleNotif',\n      message: 'Default Location updated!'\n    });\n  };\n\n  const handleClearSelection = () => {\n    setSelectedPlace(null);\n    setSearchTerm('');\n  };\n  /* For UI / HTML Elements */\n\n\n  const [cyclePosts, setCyclePosts] = React.useReducer(state => !state, false);\n  const [currentPostIndex, setCurrentPostIndex] = React.useState(0);\n  const [postInfo, setPostInfo] = React.useState([]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"MAP\",\n    className: `${current.transition == true ? 'leave' : ''}`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"header\",\n      children: [headerState == 'allPosts' && /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"All Posts\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 713,\n        columnNumber: 6\n      }, this), headerState == 'date' && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: `buttonDefault`,\n        onClick: e => {\n          setDateSelect({ ...dateSelect,\n            open: true\n          });\n          let delay = setTimeout(() => {\n            document.getElementById('dateSelection').classList.remove('_enter');\n          }, 200);\n        },\n        children: [cal.monthsAbrv[selectedDate.month], \".\", selectedDate.day, \".\", selectedDate.year]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 716,\n        columnNumber: 6\n      }, this), headerState == 'macros' && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Function Pending\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 732,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 711,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"ol_map\",\n      ref: mapRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 737,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"popUpPost\",\n      className: `${postBoardClass}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"exitButtonWrapper\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `buttonDefault`,\n          onClick: () => {\n            setPostBoardClass('down');\n          },\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 745,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 744,\n        columnNumber: 5\n      }, this), postInfo.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"text\",\n        onClick: () => {\n          setTimeout(() => {\n            navigate(`/post/${postInfo[currentPostIndex].postData._id}`, {\n              state: {\n                location: null\n              }\n            });\n          }, 600);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: postInfo[currentPostIndex].title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 763,\n          columnNumber: 7\n        }, this), postInfo[currentPostIndex].postData.content.some(data => data.type == 'text') && /*#__PURE__*/_jsxDEV(\"p\", {\n          children: postInfo[currentPostIndex].text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 766,\n          columnNumber: 8\n        }, this), postInfo[currentPostIndex].postData.content.some(data => data.type == 'media') && /*#__PURE__*/_jsxDEV(\"ul\", {\n          id: \"thumbnailsWrapper\",\n          onClick: e => {\n            e.stopPropagation();\n            let gallery = postInfo[currentPostIndex].postData.content.filter(data => data.type === 'media').map(data => ({ ...data,\n              // Spread existing properties\n              postID: postInfo[currentPostIndex].postData._id\n            }));\n            setCurrent({ ...current,\n              gallery: gallery\n            });\n          },\n          children: postInfo[currentPostIndex].postData.content.filter(data => data.type == 'media').map(data => /*#__PURE__*/_jsxDEV(\"li\", {\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              loading: \"lazy\",\n              src: data.content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 787,\n              columnNumber: 11\n            }, this)\n          }, data._id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 786,\n            columnNumber: 10\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 771,\n          columnNumber: 8\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [postInfo[currentPostIndex].tags > 0 && /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [postInfo[currentPostIndex].tags, \" tags\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 795,\n            columnNumber: 9\n          }, this), postInfo[currentPostIndex].comments > 0 && /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [postInfo[currentPostIndex].comments, \" comments\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 798,\n            columnNumber: 9\n          }, this), postInfo[currentPostIndex].taggedUsers > 0 && /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [postInfo[currentPostIndex].taggedUsers, \" users tagged\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 801,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 793,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 754,\n        columnNumber: 6\n      }, this), postInfo.length > 1 && /*#__PURE__*/_jsxDEV(\"ul\", {\n        id: \"arrowsWrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          onClick: handlePrevPost,\n          children: /*#__PURE__*/_jsxDEV(ArrowIcon, {\n            classname: ''\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 813,\n            columnNumber: 8\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 812,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          onClick: handleNextPost,\n          children: /*#__PURE__*/_jsxDEV(ArrowIcon, {\n            classname: 'left'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 816,\n            columnNumber: 8\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 815,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 810,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 741,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"filters\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Filter Posts By\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 827,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `buttonDefault ${headerState == 'allPosts' ? 'active' : 'inactive'}`,\n            onClick: () => {\n              setHeaderState('allPosts');\n            },\n            children: \"All Posts\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 831,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 830,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `buttonDefault ${headerState == 'date' ? 'active' : 'inactive'}`,\n            onClick: () => {\n              setHeaderState('date');\n            },\n            children: \"Date\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 838,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 837,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `buttonDefault ${headerState == 'macros' ? 'active' : 'inactive'}`,\n            onClick: () => {\n              setHeaderState('macros');\n            },\n            children: \"Macros\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 845,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 844,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 829,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 826,\n      columnNumber: 4\n    }, this), dateSelect.open && /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"dateSelection\",\n      className: `_enter`,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        id: \"firstNotice\",\n        children: \"Select the month, type in a year and then close this modal to set a new month\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 857,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        id: \"monthSelection\",\n        children: cal.monthsAbrv.map((month, index) => {\n          return /*#__PURE__*/_jsxDEV(\"li\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `buttonDefault ${dateSelect.month == index ? 'selected' : ''}`,\n              onClick: e => {\n                e.preventDefault();\n                setDateSelect({ ...dateSelect,\n                  month: index\n                });\n                setSelectedDate({ ...selectedDate,\n                  month: index\n                });\n              },\n              children: month\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 865,\n              columnNumber: 10\n            }, this)\n          }, month, false, {\n            fileName: _jsxFileName,\n            lineNumber: 864,\n            columnNumber: 9\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 859,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        name: \"dateSelect\",\n        type: \"number\",\n        maxLength: \"2\",\n        value: dateSelect.date,\n        onChange: onChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 883,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        id: \"secondNotice\",\n        children: \"Input Date 1 - 31\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 890,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        name: \"yearSelect\",\n        type: \"number\",\n        maxLength: \"4\",\n        value: dateSelect.year,\n        onChange: onChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 892,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        id: \"secondNotice\",\n        children: \"Input between 1900 - 2100\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 899,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        id: \"exit\",\n        className: `buttonDefault`,\n        onClick: e => {\n          e.preventDefault();\n          document.getElementById('dateSelection').classList.add('_enter');\n          let delay = setTimeout(() => {\n            setDateSelect({ ...dateSelect,\n              open: false\n            });\n          }, 200);\n        },\n        children: \"CLOSE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 901,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 855,\n      columnNumber: 5\n    }, this), current.modal == true && /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"mapSettings\",\n      className: `_enter`,\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Map Settings\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 923,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        id: \"settingsOptionsWrapper\",\n        children: /*#__PURE__*/_jsxDEV(\"li\", {\n          id: \"searchOptionWrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Set Default City\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 929,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"inputWrapper\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: searchTerm,\n              onChange: handleInputChange,\n              placeholder: \"Search for a city or country\" // disabled={!!selectedPlace} // Disable search after selection\n\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 932,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 931,\n            columnNumber: 8\n          }, this), loadingResults && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"\",\n            children: \"Loading...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 943,\n            columnNumber: 14\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            id: \"suggestions\",\n            children: suggestions.map(place => /*#__PURE__*/_jsxDEV(\"li\", {\n              className: \"\",\n              onClick: () => handleSelectSuggestion(place),\n              children: place.description\n            }, place.place_id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 948,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 946,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 927,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 925,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 921,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 709,\n    columnNumber: 3\n  }, this);\n} // {/*ChatGPT recommended change*/}\n//  <div className={`post-popup ${postBoardClass}`}>\n//     {popupPosts.length > 1 && (\n// \t    <div className=\"post-navigation\">\n// \t    \t<button onClick={handlePrevPost}>&lt;</button>\n// \t    \t<button onClick={handleNextPost}>&gt;</button>\n// \t    </div>\n//     )}\n//     <div className=\"post-content\">\n//       {popupPosts[currentPostIndex] && (\n//         \t<div>\n//           \t\t<h3>{popupPosts[currentPostIndex].title}</h3>\n//           \t\t<p>{popupPosts[currentPostIndex].description}</p>\n//           \t\t{/* Render other post details */}\n//         \t</div>\n//        )}\n//     </div>\n// </div>\n\n_s(MapComponent, \"kSdvCwJNmgYjwKAisjOLsB+DgIw=\", false, function () {\n  return [useNavigate];\n});\n\n_c3 = MapComponent;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"CenterIcon\");\n$RefreshReg$(_c2, \"ArrowIcon\");\n$RefreshReg$(_c3, \"MapComponent\");","map":{"version":3,"names":["React","ReactDOM","Map","View","TileLayer","OSM","fromLonLat","VectorLayer","VectorSource","Point","Feature","Cluster","Circle","CircleStyle","Fill","Stroke","Style","Text","Control","Header","useNavigate","APIaccess","Log","accessAPI","CenterIcon","ArrowIcon","classname","MapComponent","setCurrent","current","log","setLog","selectedDate","setSelectedDate","cal","setSocketMessage","navigate","mapState","setMapState","useState","currentCenter","setCurrentCenter","sessionStorage","getItem","markers","setMarkers","mapRef","useRef","isMapMounted","setMapMounted","postBoardInfo","setPostBoardInfo","title","text","postBoardClass","setPostBoardClass","headerState","setHeaderState","dateSelect","setDateSelect","open","month","year","date","useEffect","num","locations","filter","entry","hasOwnProperty","map","content","find","data","type","id","coords","parseFloat","location","lon","lat","undefined","tags","length","taggedUsers","comments","commentCount","postData","postedOn_month","postedOn_day","postedOn_year","customStyle","color","width","fill","stroke","size","weight","halo","dash","createTextStyle","feature","labelType","get","labelStyle","labels","font","overflow","offsetY","centerCoordinates","vectorSource","vectorLayer","source","clusterSource","distance","clusterLayer","style","image","radius","toString","forEach","marker","spot","geometry","setStyle","addFeature","ZoomInControl","constructor","opt_options","options","button","document","createElement","innerHTML","element","className","appendChild","target","addEventListener","view","initialMap","getView","zoom","getZoom","animate","duration","ZoomOutControl","RecenterControl","render","handleRecenter","bind","center","osmLayer","preload","Infinity","layers","maxZoom","on","event","forEachFeatureAtPixel","pixel","clickedCoords","getGeometry","getCoordinates","features","f","setPostInfo","thirdStep","setTimeout","addControl","setTarget","openPopupWithPosts","posts","setCurrentPostIndex","openPopupWithSinglePost","post","handleNextPost","prevIndex","postInfo","handlePrevPost","updatePreferredLocation","locationName","lonLat","request","userSettings","option","name","confirmation","message","onChange","e","value","day","selectedPlace","setSelectedPlace","suggestions","setSuggestions","searchTerm","setSearchTerm","inputType","setInputType","loadingResults","setLoadingResults","inputRef","autocompleteRef","getLocationSuggestions","query","trim","response","Error","err","console","error","handleInputChange","nativeEvent","handleSelectSuggestion","place","placeID","place_id","description","update","setItem","handleClearSelection","cyclePosts","setCyclePosts","useReducer","state","currentPostIndex","transition","delay","getElementById","classList","remove","monthsAbrv","_id","some","stopPropagation","gallery","postID","index","preventDefault","add","modal"],"sources":["/home/jce/Web Dev Space/Syncsequence/frontEnd/src/components/map/map.jsx"],"sourcesContent":["/* V I T A L S */\r\nimport * as React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Map, View } from 'ol';\r\nimport TileLayer from 'ol/layer/Tile';\r\nimport OSM from 'ol/source/OSM';\r\nimport {fromLonLat} from 'ol/proj.js';\r\nimport VectorLayer from 'ol/layer/Vector';\r\nimport VectorSource from 'ol/source/Vector';\r\nimport { Point } from 'ol/geom';\r\nimport { Feature } from 'ol';\r\nimport Cluster from 'ol/source/Cluster';\r\nimport { Circle as CircleStyle, Fill, Stroke, Style, Text} from 'ol/style';\r\nimport Control from 'ol/control/Control';\r\n\r\nimport Header from '../../components/base/header';\r\n\r\nimport {useNavigate} from 'react-router-dom';\r\nimport APIaccess from '../../apiaccess';\r\nimport Log from '../blog/log';\r\nimport 'ol/ol.css';\r\nimport './map.css';\r\n\r\nlet accessAPI = APIaccess();\r\n\r\nfunction CenterIcon({}) {\r\n\r\n\treturn (\r\n\t\t<svg \r\n\t\t\txmlns=\"http://www.w3.org/2000/svg\" \r\n\t\t\twidth=\"20.5\" \r\n\t\t\theight=\"21.11\" \r\n\t\t\tviewBox=\"0 0 20.706 21.11\">\r\n\t\t  <g id=\"Group_343\" data-name=\"Group 343\" transform=\"translate(1584 -5877)\">\r\n\t\t    <g id=\"Ellipse_27\" data-name=\"Ellipse 27\" transform=\"translate(-1580.482 5880.519)\" fill=\"none\" stroke=\"rgba(0,0,0,0.4)\" stroke-width=\"2\">\r\n\t\t      <circle cx=\"7.037\" cy=\"7.037\" r=\"7.037\" stroke=\"none\" />\r\n\t\t      <circle cx=\"7.037\" cy=\"7.037\" r=\"6.037\" fill=\"none\" />\r\n\t\t    </g>\r\n\t\t    <line id=\"Line_206\" data-name=\"Line 206\" y1=\"3.518\" transform=\"translate(-1573.445 5877)\" fill=\"none\" stroke=\"rgba(0,0,0,0.4)\" stroke-width=\"2\" />\r\n    \t\t<line id=\"Line_207\" data-name=\"Line 207\" y1=\"3.451\" transform=\"translate(-1563.294 5887.354) rotate(90)\" fill=\"none\" stroke=\"rgba(0,0,0,0.4)\" stroke-width=\"2\" />\r\n    \t\t<line id=\"Line_208\" data-name=\"Line 208\" y1=\"3.451\" transform=\"translate(-1580.549 5887.354) rotate(90)\" fill=\"none\" stroke=\"rgba(0,0,0,0.4)\" stroke-width=\"2\" />\r\n    \t\t<line id=\"Line_209\" data-name=\"Line 209\" y1=\"3.518\" transform=\"translate(-1573.445 5894.592)\" fill=\"none\" stroke=\"rgba(0,0,0,0.4)\" stroke-width=\"2\" />\r\n\t\t  </g>\r\n\t\t</svg>\r\n\t)\r\n}\r\n\r\nfunction ArrowIcon({classname}) {\r\n\treturn (\r\n\t\t<svg \r\n\t\t\txmlns=\"http://www.w3.org/2000/svg\" \r\n\t\t\twidth=\"25.624\" \r\n\t\t\theight=\"7.866\" \r\n\t\t\tviewBox=\"0 0 25.624 7.866\"\r\n\t\t\tclassName={`${classname}`}>\r\n\t\t  <g id=\"Group_224\" data-name=\"Group 224\" transform=\"translate(-22 -25.634)\">\r\n\t\t    <line fill=\"none\" stroke=\"rgba(0,0,0,0.4)\" stroke-width=\"2\" id=\"Line_146\" data-name=\"Line 146\" class=\"cls-1\" x2=\"25\" transform=\"translate(22.624 32.5)\"/>\r\n\t\t    <line fill=\"none\" stroke=\"rgba(0,0,0,0.4)\" stroke-width=\"2\" id=\"Line_148\" data-name=\"Line 148\" class=\"cls-1\" x2=\"12\" transform=\"translate(22.5 32.5) rotate(-30)\"/>\r\n\t\t  </g>\r\n\t\t</svg>\r\n\t)\r\n}\r\n\r\nexport default function MapComponent ({ \r\n\tsetCurrent, \r\n\tcurrent, \r\n\tlog, \r\n\tsetLog, \r\n\tselectedDate, \r\n\tsetSelectedDate, \r\n\tcal,\r\n\tsetSocketMessage\r\n}) {\r\n\r\n\tconst navigate = useNavigate();\r\n\tconst [mapState, setMapState] = React.useState(null);\r\n\tconst [currentCenter, setCurrentCenter] = React.useState(\r\n\t\t[sessionStorage.getItem('settings_preferredLocation_lon'),\r\n\t\tsessionStorage.getItem('settings_preferredLocation_lat')]\r\n\t);\r\n\tconst [markers, setMarkers] = React.useState([\r\n\t\t// { \r\n\t\t// \tid: 1, \r\n\t\t// \tcoords: [-73.9249, 40.6943], \r\n\t\t// \ttitle: 'First Spot',\r\n\t\t// \ttext: 'This is just some filler text to place within this pop up element that we have here. No important information relevant to anything.' \r\n\t\t// },\r\n\t\t// { \t\r\n\t\t// \tid: 2, \r\n\t\t// \tcoords: [-73.935242, 40.730610], \r\n\t\t// \ttitle: 'Second Spot',\r\n\t\t// \ttext: 'These are some words that the dev would like to place here as filler content. It is of no importance or effect to anything'\r\n\t\t// }\r\n\t]);\r\n\tconst mapRef = React.useRef();\r\n\tconst [isMapMounted, setMapMounted] = React.useState(false);\r\n\tconst [postBoardInfo, setPostBoardInfo] = React.useState({\r\n\t\ttitle: null,\r\n\t\ttext: null\r\n\t}); \r\n\tconst [postBoardClass, setPostBoardClass] = React.useState('down');//up or down\r\n\tconst [headerState, setHeaderState] = React.useState('allPosts'); //allPosts, date or macros\r\n\tconst [dateSelect, setDateSelect] = React.useState({\r\n\t\topen: false,\r\n\t\tmonth: null,\r\n\t\tyear: null,\r\n\t\tdate: null\r\n\t})\r\n\r\n\r\n\r\n\t/* \r\n\t\tExtracts data from log for markers and popUpPanel\r\n\t   \tand Filters posts based on headerState \r\n\t*/\r\n\tReact.useEffect(()=> {\r\n\r\n\t\tif(headerState == 'allPosts') {\r\n\t\t\tlet num = 0;\r\n\t\t\tlet locations = log.filter(entry => entry.hasOwnProperty('location')).map(entry => {\r\n\r\n\t\t\t\tlet text;\r\n\t\t\t\tif(entry.content.find((data) => data.type == 'text')) {\r\n\t\t\t\t\ttext = entry.content.find((data) => data.type == 'text');\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: num,\r\n\t\t\t\t\tcoords: [parseFloat(entry.location.lon), parseFloat(entry.location.lat)],\r\n\t\t\t\t\ttitle: entry.title,\r\n\t\t\t\t\ttext: text != undefined ? text.content : null,\r\n\t\t\t\t\ttags: entry.tags ? entry.tags.length : null,\r\n\t\t\t\t\ttaggedUsers: entry.taggedUsers ? entry.taggedUsers.length : null,\r\n\t\t\t\t\tcomments: entry.commentCount,\r\n\t\t\t\t\tpostData: entry\r\n\t\t\t\t}\r\n\t\t\t\tnum++\r\n\t\t\t});\r\n\t\t\tsetMarkers(locations);\r\n\t\t}\r\n\t\tif(headerState == 'date') {\r\n\r\n\t\t\tlet num = 0;\r\n\t\t\tlet locations = log.filter((entry) => {\r\n\t\t\t\tif(entry.hasOwnProperty('location')) {\r\n\r\n\t\t\t\t\tif((entry.postedOn_month == dateSelect.month && entry.postedOn_day == dateSelect.date) \r\n\t\t\t\t\t\t&& entry.postedOn_year == dateSelect.year) {\r\n\t\t\t\t\t\treturn entry;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).map(entry => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: num,\r\n\t\t\t\t\t// coords: points,\r\n\t\t\t\t\tcoords: [parseFloat(entry.location.lon), parseFloat(entry.location.lat)],\r\n\t\t\t\t\ttitle: entry.title,\r\n\t\t\t\t\ttext: entry.content[0].content,\r\n\t\t\t\t\ttags: entry.tags ? entry.tags.length : null,\r\n\t\t\t\t\ttaggedUsers: entry.taggedUsers ? entry.taggedUsers.length : null,\r\n\t\t\t\t\tcomments: entry.commentCount,\r\n\t\t\t\t\tpostData: entry\r\n\t\t\t\t}\r\n\t\t\t\tnum++\r\n\t\t\t});\r\n\t\tsetMarkers(locations);\r\n\t\t}\r\n\t}, [headerState, dateSelect, ])\r\n\r\n\r\n\t/*  T H E   M A P\r\n\t\tRenders Open Layers Map on Component Mount */\r\n\tReact.useEffect(()=> {\r\n\r\n\t\tconst customStyle = {\r\n\t      'background-color': '#f2efe9',\r\n\t      'roads': {\r\n\t        'major': {\r\n\t          color: '#34495e',\r\n\t          width: 2\r\n\t        },\r\n\t        'minor': {\r\n\t          color: '#7f8c8d',\r\n\t          width: 1\r\n\t        },\r\n\t        'highway': {\r\n\t          color: '#e74c3c',\r\n\t          width: 3\r\n\t        }\r\n\t      },\r\n\t      'water': {\r\n\t        fill: '#3498db',\r\n\t        stroke: '#2980b9'\r\n\t      },\r\n\t      'parks': {\r\n\t        fill: '#2ecc71',\r\n\t        stroke: '#27ae60'\r\n\t      },\r\n\t      'buildings': {\r\n\t        fill: '#95a5a6',\r\n\t        stroke: '#7f8c8d'\r\n\t      },\r\n\t      'labels': {\r\n\t        'city': {\r\n\t          color: '#2c3e50',\r\n\t          size: '14px',\r\n\t          weight: 'bold',\r\n\t          halo: {\r\n\t            color: '#ffffff',\r\n\t            width: 2\r\n\t          }\r\n\t        },\r\n\t        'town': {\r\n\t          color: '#34495e',\r\n\t          size: '12px',\r\n\t          weight: 'normal',\r\n\t          halo: {\r\n\t            color: '#ffffff',\r\n\t            width: 1\r\n\t          }\r\n\t        },\r\n\t        'poi': {\r\n\t          color: '#8e44ad',\r\n\t          size: '11px',\r\n\t          weight: 'normal',\r\n\t          halo: {\r\n\t            color: '#ffffff',\r\n\t            width: 1\r\n\t          }\r\n\t        }\r\n\t      },\r\n\t      'boundaries': {\r\n\t        'administrative': {\r\n\t          color: '#bdc3c7',\r\n\t          width: 1,\r\n\t          dash: [4, 4]  // Creates a dashed line\r\n\t        },\r\n\t        'country': {\r\n\t          color: '#7f8c8d',\r\n\t          width: 2\r\n\t        }\r\n\t      },\r\n\t      'landuse': {\r\n\t        'residential': '#ecf0f1',\r\n\t        'commercial': '#e8e0d8',\r\n\t        'industrial': '#dad5d2',\r\n\t        'agricultural': '#dcedc8'\r\n\t      },\r\n\t      'terrain': {\r\n\t        'contour': '#b39ddb',\r\n\t        'hillshade': '#000000',\r\n\t        'hillshadeOpacity': 0.1\r\n\t      }\r\n\t    };\r\n\r\n\t    const createTextStyle = (feature) => {\r\n\t      const labelType = feature.get('labelType') || 'city';\r\n\t      const labelStyle = customStyle.labels[labelType];\r\n\t      \r\n\t      return new Text({\r\n\t        text: feature.get('name'),\r\n\t        font: `${labelStyle.weight} ${labelStyle.size} Arial`,\r\n\t        fill: new Fill({\r\n\t          color: labelStyle.color\r\n\t        }),\r\n\t        stroke: new Stroke({\r\n\t          color: labelStyle.halo.color,\r\n\t          width: labelStyle.halo.width\r\n\t        }),\r\n\t        overflow: true,\r\n\t        offsetY: -15\r\n\t      });\r\n\t    };\r\n\r\n\r\n\t\tlet centerCoordinates = fromLonLat(currentCenter);\r\n\r\n\r\n\t\t//Creates necessary layer for adding circle spots on map\r\n\t\tconst vectorSource = new VectorSource();\r\n\r\n\t\t//create vector layer with vectorSource\r\n\t\tconst vectorLayer = new VectorLayer({\r\n\t\t\tsource: vectorSource\r\n\t\t})\r\n\r\n\t\tconst clusterSource = new Cluster({\r\n\t\t\tdistance: 40,\r\n\t\t\tsource: vectorSource\r\n\t\t})\r\n\r\n\t\tconst clusterLayer = new VectorLayer({\r\n\t\t\tsource: clusterSource,\r\n\t\t\tstyle: (feature) => {\r\n\t\t\t\tconst size = feature.get('features').length;\r\n\r\n\t\t\t\tif(size > 1) {\r\n\t\t\t\t\treturn new Style({\r\n\t\t\t\t      image: new CircleStyle({\r\n\t\t\t\t        radius: 18, // larger radius for clusters\r\n\t\t\t\t        fill: new Fill({ color: 'rgba(0, 82, 255, 0.5)' }),\r\n\t\t\t\t        stroke: new Stroke({ color: 'white', width: 2 }),\r\n\t\t\t\t      }),\r\n\t\t\t\t      text: new Text({\r\n\t\t\t\t        text: size > 1 ? size.toString(): '', // show the number of posts in the cluster\r\n\t\t\t\t        font: '300 16px Raleway',\r\n\t\t\t\t        fill: new Fill({ color: 'transparent' }),\r\n\t\t\t\t        stroke: new Stroke({ color: 'white', width: 2 }),\r\n\t\t\t\t      }),\r\n\t\t\t\t    });\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn new Style({\r\n\t\t\t\t      image: new CircleStyle({\r\n\t\t\t\t        radius: 10,\r\n\t\t\t\t        fill: new Fill({ color: 'rgba(0, 82, 255, 0.5)' }),\r\n\t\t\t\t        stroke: new Stroke({ color: 'white', width: 2 }),\r\n\t\t\t\t      }),\r\n\t\t\t\t    });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t//creates markers from coordinates, adds them to VectorSource\r\n\t\tmarkers.forEach(marker => {\r\n\r\n\t\t\tlet spot = new Feature({\r\n\t\t\t\tgeometry: new Point(fromLonLat(marker.coords)),\r\n\t\t\t\tdata: marker\r\n\t\t\t})\r\n\r\n\t\t\tspot.setStyle(new Style({\r\n\t\t\t\timage: new CircleStyle({\r\n\t\t\t\t\tradius: 8,\r\n\t\t\t\t\tfill: new Fill({ color: 'grey' }),\r\n\t\t\t\t\tstroke: new Stroke({ color: 'white', width: 2 })\r\n\t\t\t\t})\r\n\t\t\t}));\r\n\r\n\t\t\tvectorSource.addFeature(spot);\r\n\t\t\tclusterSource.addFeature(spot);\r\n\t\t})\r\n\r\n\t\t// Create a custom Zoom In button control\r\n\t\tclass ZoomInControl extends Control {\r\n\t      constructor(opt_options) {\r\n\t        const options = opt_options || {};\r\n\r\n\t        // Create a button element\r\n\t        const button = document.createElement('button');\r\n\t        button.id = 'zoomIn';\r\n\t        button.innerHTML = '+';\r\n\r\n\t        // Create a div element to wrap the button\r\n\t        const element = document.createElement('div');\r\n\t        element.className = 'zoom-in-button ol-unselectable ol-control';\r\n\t        element.appendChild(button);\r\n\r\n\t        super({\r\n\t          element: element,\r\n\t          target: options.target\r\n\t        });\r\n\r\n\t        button.addEventListener('click', () => {\r\n\t          const view = initialMap.getView();\r\n\t          const zoom = view.getZoom();\r\n\t          view.animate({\r\n\t          \tzoom: zoom + 1,\r\n\t          \tduration: 500\r\n\t          });\r\n\t        });\r\n\t      }\r\n\t    }\r\n\r\n\t    // Create a custom Zoom Out button control (bottom-left)\r\n\t    class ZoomOutControl extends Control {\r\n\t      constructor(opt_options) {\r\n\t        const options = opt_options || {};\r\n\r\n\t        // Create a button element\r\n\t        const button = document.createElement('button');\r\n\t        button.id = 'zoomOut';\r\n\t        button.innerHTML = '-';\r\n\r\n\t        // Create a div element to wrap the button\r\n\t        const element = document.createElement('div');\r\n\t        element.className = 'zoom-out-button ol-unselectable ol-control';\r\n\t         // Position it at the bottom-left\r\n\t        element.appendChild(button);\r\n\r\n\t        super({\r\n\t          element: element,\r\n\t          target: options.target\r\n\t        });\r\n\r\n\t        button.addEventListener('click', () => {\r\n\t          const view = initialMap.getView();\r\n\t          const zoom = view.getZoom();\r\n\t          view.animate({\r\n\t          \tzoom: zoom - 1,\r\n\t          \tduration: 500\r\n\t          }); \r\n\t        });\r\n\t      }\r\n\t    }\r\n\r\n\t\t// Create a custom \"Recenter\" button control\r\n\t    class RecenterControl extends Control {\r\n\t      constructor(opt_options) {\r\n\t        const options = opt_options || {};\r\n\r\n\t        // Create a button element\r\n\t        const button = document.createElement('button');\r\n\t        button.id = 'recenter';\r\n\r\n\t        // Create a div element to wrap the button\r\n\t        const element = document.createElement('div');\r\n\t        element.className = 'recenter-button ol-unselectable ol-control';\r\n\t        element.appendChild(button);\r\n\r\n\t        super({\r\n\t          element: element,\r\n\t          target: options.target\r\n\t        });\r\n\r\n\t        ReactDOM.render(<CenterIcon />, button);\r\n\r\n\t        // Handle the button click event\r\n\t        button.addEventListener('click', this.handleRecenter.bind(this), false);\r\n\t      }\r\n\r\n\t      handleRecenter() {\r\n\t        // Animate the map to recenter on the initial coordinates\r\n\t        const view = initialMap.getView();\r\n\t        view.animate({\r\n\t          center: fromLonLat(currentCenter),\r\n\t          zoom: 11,\r\n\t          duration: 500\r\n\t        });\r\n\t      }\r\n\t    }\r\n\r\n\t\t//create OSM / Tile layer\r\n\t\tconst osmLayer = new TileLayer({\r\n\t\t\tpreload: Infinity,\r\n\t\t\tsource: new OSM(),\r\n\t\t});\r\n\r\n\t\tconst initialMap = new Map({\r\n\t\t\ttarget: mapRef.current,\r\n\t\t\tlayers: [osmLayer, clusterLayer],\r\n\t\t\tview: new View({\r\n\t\t\t\tcenter: centerCoordinates, //lat n lng\r\n\t\t\t\tzoom: 11,\r\n\t\t\t\tmaxZoom: 15\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\tinitialMap.on('click', (event)=> {\r\n\t\t\tinitialMap.forEachFeatureAtPixel(event.pixel, (feature) => {\r\n\t\t\t\tconst clickedCoords = feature.getGeometry().getCoordinates();\r\n\r\n\t\t\t\t// let data = feature.get('data');\r\n\r\n\t\t\t\tconst features = feature.get('features');\r\n\r\n\t\t\t\tif (features.length > 1) { //if multiple posts\r\n\t\t\t\t\tconst postData = features.map(f => f.get('data'));\r\n\t\t\t\t\tsetPostInfo(postData)\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconst data = features[0].get('data');\r\n\t\t\t\t\tsetPostInfo([data]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetPostBoardClass('down')\r\n\r\n\t\t\t\t// let secondStep = setTimeout(()=> {\r\n\t\t\t\t// \tsetPostBoardInfo(data)\r\n\t\t\t\t// }, 600);\r\n\t\t\t\t\t\r\n\t\t\t\tlet thirdStep = setTimeout(()=> {\r\n\t\t\t\t\tsetPostBoardClass('up')\r\n\t\t\t\t}, 1000);\r\n\r\n\t\t\t\tinitialMap.getView().animate({\r\n\t\t\t\t\tcenter: clickedCoords,\r\n\t\t\t\t\tzoom: 14,\r\n\t\t\t\t\tduration: 750\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tinitialMap.addControl(new RecenterControl());\r\n\t\tinitialMap.addControl(new ZoomInControl());\r\n    \tinitialMap.addControl(new ZoomOutControl());\r\n\r\n\t\tsetMapState(initialMap)\r\n\r\n\t\t//Removes map on unmount\r\n\t\treturn ()=> {\r\n\t\t\t// if(initialMap) {\r\n\r\n\t\t\t\tinitialMap.setTarget(null);\r\n\r\n\t\t\t\t // Remove event listeners\r\n\t\t\t\t// initialMap.un('click', clickListener);\r\n\r\n\t\t\t\t// Remove controls (if dynamically added)\r\n\t\t\t\t// initialMap.getControls().clear();\r\n\r\n\t\t\t\t//Detachs map from the DOM\r\n\t\t\t\t// initialMap.setTarget(null);\r\n\r\n\t\t\t\t//Clears the vector layer\r\n\t\t\t\t// vectorSource.clear()\r\n\t\t\t// }\t\t\r\n\t\t}\r\n\t}, [currentCenter, markers, isMapMounted]) \r\n\r\n\r\n\tfunction openPopupWithPosts(posts) {\r\n\t\tsetPostInfo(posts);\r\n\t\tsetCurrentPostIndex(0);\r\n\t\tsetPostBoardClass('down');\r\n\t\tsetTimeout(() => setPostBoardClass('up'), 1000);\r\n\t}\r\n\r\n\tfunction openPopupWithSinglePost(post) {\r\n\t\tsetPostInfo([post]);\r\n\t\tsetCurrentPostIndex(0);\r\n\t\tsetPostBoardClass('down');\r\n\t\tsetTimeout(() => setPostBoardClass('up'), 1000);\r\n\t}\r\n\r\n\tfunction handleNextPost() {\r\n\t\tsetCurrentPostIndex((prevIndex) => (prevIndex + 1) % postInfo.length);\r\n\t}\r\n\r\n\tfunction handlePrevPost() {\r\n\t\tsetCurrentPostIndex((prevIndex) => (prevIndex - 1 + postInfo.length) % postInfo.length);\r\n\t}\r\n\r\n\tasync function updatePreferredLocation(locationName, lonLat) {\r\n\t\tlet request = await accessAPI.userSettings({\r\n\t\t\toption: 'updateLocation',\r\n\t\t\tname: 'locationName',\r\n\t\t\tlonLat: lonLat //is array\r\n\t\t})\r\n\r\n\t\tif(request.confirmation == true) {\r\n\t\t\tsetSocketMessage({\r\n\t\t\t\ttype: 'simpleNotif',\r\n\t\t\t\tmessage: `Default Location saved to ${locationName}`\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/* For Date Select */\r\n\tconst onChange = (e) => {\r\n\r\n\t\tif(e.target.name == 'yearSelect') {\r\n\t\t\tsetDateSelect({\r\n\t\t\t\t...dateSelect,\r\n\t\t\t\tyear: e.target.value\r\n\t\t\t})\r\n\t\t\tif(e.target.value.length == 4) {\r\n\t\t\t\tsetSelectedDate({\r\n\t\t\t\t\t...selectedDate,\r\n\t\t\t\t\tyear: e.target.value\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(e.target.name == 'dateSelect') {\r\n\t\t\tsetDateSelect({\r\n\t\t\t\t...dateSelect,\r\n\t\t\t\tdate: e.target.value\r\n\t\t\t})\r\n\t\t\tsetSelectedDate({\r\n\t\t\t\t...selectedDate,\r\n\t\t\t\tday: e.target.value\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/* For Map Settings */\r\n\tconst [selectedPlace, setSelectedPlace] = React.useState(null); // Only allow one selection\r\n  \tconst [suggestions, setSuggestions] = React.useState([]);\r\n  \tconst [searchTerm, setSearchTerm] = React.useState(\r\n  \t\tsessionStorage.getItem('settings_preferredLocation_name') ?\r\n  \t\tsessionStorage.getItem('settings_preferredLocation_name') : ''  );\r\n  \tconst [inputType, setInputType] = React.useState(\"\");\r\n  \tconst [loadingResults, setLoadingResults] = React.useState(false);\r\n  \tconst inputRef = React.useRef(null);\r\n  \tconst autocompleteRef = React.useRef(null);\r\n\r\n  \tconst getLocationSuggestions = async(query) => {\r\n  \t\ttry {\r\n\r\n  \t\t\tif(!query.trim()) {\r\n  \t\t\t\tsetSuggestions([]);\r\n  \t\t\t\treturn;\r\n  \t\t\t}\r\n\r\n  \t\t\tsetLoadingResults(true)\r\n  \t\t\tconst response = await accessAPI.userSettings({\r\n  \t\t\t\toption: 'searchLocation',\r\n  \t\t\t\tquery: query\r\n  \t\t\t});\r\n\r\n  \t\t\tif(response.length > 0) {\r\n  \t\t\t\tsetSuggestions(response);\r\n  \t\t\t}\r\n  \t\t\telse {\r\n  \t\t\t\tthrow new Error('Failed to fetch places');\r\n  \t\t\t}\r\n\r\n  \t\t}\r\n  \t\tcatch (err) {\r\n  \t\t\tconsole.error('Error fetching suggestions:', err);\r\n      \t\t// setError(err.message);\r\n  \t\t}\r\n  \t\tfinally {\r\n  \t\t\tsetLoadingResults(false);\r\n  \t\t}\r\n  \t}\r\n\r\n  \tconst handleInputChange = (e) => {\r\n  \t\tconst value = e.target.value;\r\n  \t\tsetInputType(e.nativeEvent.inputType);\r\n  \t\tsetSearchTerm(value)\r\n\r\n  \t\t// if (e.nativeEvent.inputType === \"deleteContentBackward\") {\r\n\t\t//     return;\r\n\t\t// }\r\n  \t}\r\n\r\n  \tReact.useEffect(()=> {\r\n\r\n  \t\tconsole.log(searchTerm.length);\r\n\r\n  \t\tif(searchTerm == sessionStorage.getItem('settings_preferredLocation_name')) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tif (inputType === \"deleteContentBackward\") {\r\n\t      \treturn;\r\n\t    }\r\n\r\n  \t\tif(searchTerm.length < 2) {\r\n  \t\t\tconsole.log('empty')\r\n  \t\t\tsetSuggestions([]);\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\t// if(selectedPlace.name == searchTerm) {\r\n  \t\t// \treturn;\r\n  \t\t// }\r\n\r\n  \t\tgetLocationSuggestions(searchTerm)\r\n  \t}, [searchTerm])\r\n\r\n\r\n  \tconst handleSelectSuggestion = async(place) => {\r\n\r\n  \t\tconst response = await accessAPI.userSettings({\r\n  \t\t\t\toption: 'searchLocationDetails',\r\n  \t\t\t\tplaceID: place.place_id\r\n  \t\t});\r\n\r\n  \t\tsetSelectedPlace({\r\n  \t\t\tname: place.description,\r\n  \t\t\tlonLat: response.lonLat\r\n  \t\t})\r\n\r\n  \t\tsetSuggestions([]);\r\n  \t\tsetSearchTerm(place.description);\r\n\r\n\t\tconst update = await accessAPI.userSettings({\r\n  \t\t\toption: 'updateLocation',\r\n  \t\t\tname: place.description,\r\n  \t\t\tlonLat: response.lonLat\r\n  \t\t})\r\n\r\n  \t\tsessionStorage.setItem('settings_preferredLocation_lon', response.lonLat[0]);\r\n  \t\tsessionStorage.setItem('settings_preferredLocation_lat', response.lonLat[1]);\r\n  \t\tsessionStorage.setItem('settings_preferredLocation_name', place.description);\r\n\r\n  \t\tsetSocketMessage({\r\n\t  \t\ttype: 'simpleNotif',\r\n\t  \t\tmessage: 'Default Location updated!'\r\n\t  \t})\t\r\n  \t}\r\n\r\n  \tconst handleClearSelection = () => {\r\n  \t\tsetSelectedPlace(null);\r\n  \t\tsetSearchTerm('');\r\n  \t}\r\n\r\n\r\n\r\n  \t/* For UI / HTML Elements */\r\n\tconst [cyclePosts, setCyclePosts] = React.useReducer(state => !state, false);\r\n\tconst [currentPostIndex, setCurrentPostIndex] = React.useState(0);\r\n\tconst [postInfo, setPostInfo] = React.useState([]);\r\n\r\n\treturn (\r\n\t\t<div id=\"MAP\" className={`${current.transition == true ? 'leave' : ''}`}>\r\n\t\t\t\r\n\t\t\t<div id=\"header\">\r\n\t\t\t\t{headerState == 'allPosts' &&\r\n\t\t\t\t\t<h2>All Posts</h2>\r\n\t\t\t\t}\r\n\t\t\t\t{headerState == 'date' &&\r\n\t\t\t\t\t<button className={`buttonDefault`}\r\n\t\t\t\t\t\t\tonClick={(e)=> {\r\n\t\t\t\t\t\t\t\tsetDateSelect({\r\n\t\t\t\t\t\t\t\t\t...dateSelect,\r\n\t\t\t\t\t\t\t\t\topen: true\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tlet delay = setTimeout(()=> {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('dateSelection').classList.remove('_enter');\t\t\t\t\r\n\t\t\t\t\t\t\t\t}, 200)\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\t{cal.monthsAbrv[selectedDate.month]}. \r\n\t\t\t\t\t\t{selectedDate.day}. \r\n\t\t\t\t\t\t{selectedDate.year}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t}\r\n\t\t\t\t{headerState == 'macros' &&\r\n\t\t\t\t\t<p>Function Pending</p>\r\n\t\t\t\t}\r\n\t\t\t</div>\t\r\n\r\n\t\t\t{/* T H I S  I S  T H E  O L  M A P */}\r\n\t\t\t<div id=\"ol_map\" ref={mapRef}></div>\r\n\r\n\r\n\t\t\t{/*P O S T  P A N E L  W R A P P E R*/}\r\n\t\t\t<div id=\"popUpPost\" className={`${postBoardClass}`}>\r\n\t\t\t\t\r\n\t\t\t\t{/* E X I T  B U T T O N */}\r\n\t\t\t\t<div id=\"exitButtonWrapper\">\r\n\t\t\t\t\t<button className={`buttonDefault`}\r\n\t\t\t\t\t\t\tonClick={()=> {\r\n\t\t\t\t\t\t\t\tsetPostBoardClass('down');\r\n\t\t\t\t\t\t\t}}>×</button>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{/*T E X T   W R A P P E R*/}\r\n\t\t\t\t{postInfo.length > 0 &&\r\n\r\n\t\t\t\t\t<div id=\"text\" onClick={()=> {\r\n\t\t\t\t\t\tsetTimeout(()=> {\r\n\t\t\t\t\t\t\tnavigate(`/post/${postInfo[currentPostIndex].postData._id}`, {\r\n\t\t\t\t\t\t\t\tstate: {\r\n\t\t\t\t\t\t\t\t\tlocation: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, 600)\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\t<h2>{postInfo[currentPostIndex].title}</h2>\r\n\r\n\t\t\t\t\t\t{postInfo[currentPostIndex].postData.content.some((data) => data.type == 'text') &&\r\n\t\t\t\t\t\t\t<p>{postInfo[currentPostIndex].text}</p>\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t{/* Wrapper for Media Elements */} \r\n\t\t\t\t\t\t{postInfo[currentPostIndex].postData.content.some((data) => data.type == 'media') &&\r\n\t\t\t\t\t\t\t<ul id=\"thumbnailsWrapper\" onClick={(e)=> {\r\n\t\t\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\t\t\tlet gallery = postInfo[currentPostIndex].postData.content.filter(data => data.type === 'media')\r\n  \t\t\t\t\t\t\t\t\t.map(data => ({\r\n    \t\t\t\t\t\t\t\t\t...data,   // Spread existing properties\r\n    \t\t\t\t\t\t\t\t\tpostID: postInfo[currentPostIndex].postData._id \r\n  \t\t\t\t\t\t\t\t\t}));\r\n\r\n\t\t\t\t\t\t\t\tsetCurrent({\r\n\t\t\t\t\t\t\t\t\t...current,\r\n\t\t\t\t\t\t\t\t\tgallery: gallery\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t{postInfo[currentPostIndex].postData.content.filter(data => data.type == 'media').map(data => (\r\n\t\t\t\t\t\t\t\t\t<li key={data._id}>\r\n\t\t\t\t\t\t\t\t\t\t<img loading=\"lazy\" src={data.content} />\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t{postInfo[currentPostIndex].tags > 0 &&\r\n\t\t\t\t\t\t\t\t<li>{postInfo[currentPostIndex].tags} tags</li>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{postInfo[currentPostIndex].comments > 0 &&\r\n\t\t\t\t\t\t\t\t<li>{postInfo[currentPostIndex].comments} comments</li>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{postInfo[currentPostIndex].taggedUsers > 0 &&\r\n\t\t\t\t\t\t\t\t<li>{postInfo[currentPostIndex].taggedUsers} users tagged</li>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\t\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t{/*C Y C L E  P O S T S*/}\r\n\t\t\t\t{postInfo.length > 1 &&\r\n\t\t\t\t\t<ul id=\"arrowsWrapper\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<li onClick={handlePrevPost}>\r\n\t\t\t\t\t\t\t<ArrowIcon classname={''} />\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t<li onClick={handleNextPost}>\r\n\t\t\t\t\t\t\t<ArrowIcon classname={'left'} />\r\n\t\t\t\t\t\t</li>\r\n\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\r\n\t\t\t\r\n\r\n\t\t\t{/* F I L T E R S*/}\r\n\t\t\t<div id=\"filters\"> \r\n\t\t\t\t<p>Filter Posts By</p>\r\n\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<button className={`buttonDefault ${headerState == 'allPosts' ? 'active' : 'inactive'}`} \r\n\t\t\t\t\t\t\t\tonClick={()=> {\r\n\t\t\t\t\t\t\t\t\tsetHeaderState('allPosts')\r\n\t\t\t\t\t\t\t\t}}>All Posts</button>\r\n\t\t\t\t\t</li>\r\n\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<button className={`buttonDefault ${headerState == 'date' ? 'active' : 'inactive'}`}\r\n\t\t\t\t\t\t\t\tonClick={()=> {\r\n\t\t\t\t\t\t\t\t\tsetHeaderState('date')\r\n\t\t\t\t\t\t\t\t}}>Date</button>\r\n\t\t\t\t\t</li>\r\n\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<button className={`buttonDefault ${headerState == 'macros' ? 'active' : 'inactive'}`}\r\n\t\t\t\t\t\t\t\tonClick={()=> {\r\n\t\t\t\t\t\t\t\t\tsetHeaderState('macros')\r\n\t\t\t\t\t\t\t\t}}>Macros</button>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* D A T E  S E L E C T I O N */}\r\n\t\t\t{dateSelect.open &&\r\n\t\t\t\t<div id=\"dateSelection\" className={`_enter`}>\r\n\r\n\t\t\t\t\t<p id=\"firstNotice\">Select the month, type in a year and then close this modal to set a new month</p>\r\n\r\n\t\t\t\t\t<ul id=\"monthSelection\">\r\n\r\n\t\t\t\t\t\t{cal.monthsAbrv.map((month, index)=> {\r\n\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<li key={month}>\r\n\t\t\t\t\t\t\t\t\t<button className={`buttonDefault ${dateSelect.month == index ? 'selected' : ''}`}\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={(e)=> {\r\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\t\tsetDateSelect({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...dateSelect,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmonth: index\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\tsetSelectedDate({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...selectedDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmonth: index\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t\t{month}</button>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</ul>\r\n\r\n\t\t\t\t\t<input \r\n\t\t\t\t\t\tname=\"dateSelect\"\r\n\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\tmaxLength=\"2\"\r\n\t\t\t\t\t\tvalue={dateSelect.date}\r\n\t\t\t\t\t\tonChange={onChange}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t<p id=\"secondNotice\">Input Date 1 - 31</p>\r\n\r\n\t\t\t\t\t<input \r\n\t\t\t\t\t\tname=\"yearSelect\"\r\n\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\tmaxLength=\"4\"\r\n\t\t\t\t\t\tvalue={dateSelect.year}\r\n\t\t\t\t\t\tonChange={onChange}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t<p id=\"secondNotice\">Input between 1900 - 2100</p>\r\n\r\n\t\t\t\t\t<button id=\"exit\"\r\n\t\t\t\t\t\t\tclassName={`buttonDefault`}\r\n\t\t\t\t\t\t\tonClick={(e)=> {\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tdocument.getElementById('dateSelection').classList.add('_enter');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlet delay = setTimeout(()=> {\r\n\t\t\t\t\t\t\t\t\tsetDateSelect({\r\n\t\t\t\t\t\t\t\t\t\t...dateSelect,\r\n\t\t\t\t\t\t\t\t\t\topen: false\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}, 200)\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\tCLOSE\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\r\n\t\t\t{/* S E T T I N G S */}\r\n\t\t\t{current.modal == true &&\r\n\t\t\t\t<div id=\"mapSettings\" className={`_enter`}>\r\n\r\n\t\t\t\t\t<h2>Map Settings</h2>\r\n\r\n\t\t\t\t\t<ul id=\"settingsOptionsWrapper\">\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<li id=\"searchOptionWrapper\">\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<h3>Set Default City</h3>\r\n\r\n\t\t\t\t\t\t\t<div id=\"inputWrapper\">\t\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t        type=\"text\"\r\n\t\t\t\t\t\t\t        value={searchTerm}\r\n\t\t\t\t\t\t\t        onChange={handleInputChange}\r\n\t\t\t\t\t\t\t        placeholder=\"Search for a city or country\"\r\n\t\t\t\t\t\t\t        // disabled={!!selectedPlace} // Disable search after selection\r\n\t\t\t\t\t\t\t    />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t      {loadingResults && \r\n\t\t\t\t\t\t      \t<p className=\"\">Loading...</p>\r\n\t\t\t\t\t\t      }\r\n\r\n\t\t\t\t\t\t      <ul id=\"suggestions\">\r\n\t\t\t\t\t\t          {suggestions.map((place) => (\r\n\t\t\t\t\t\t            <li\r\n\t\t\t\t\t\t              key={place.place_id}\r\n\t\t\t\t\t\t              className=\"\"\r\n\t\t\t\t\t\t              onClick={() => handleSelectSuggestion(place)}\r\n\t\t\t\t\t\t            >\r\n\t\t\t\t\t\t              {place.description}\r\n\t\t\t\t\t\t            </li>\r\n\t\t\t\t\t\t          ))}\r\n\t\t\t\t\t\t       </ul>\r\n\r\n\t\t\t\t\t\t</li>\r\n\r\n\t\t\t\t\t</ul>\r\n\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\n\r\n\t\t\t// {/*ChatGPT recommended change*/}\r\n\t\t\t//  <div className={`post-popup ${postBoardClass}`}>\r\n\t\t\t//     {popupPosts.length > 1 && (\r\n\t\t\t// \t    <div className=\"post-navigation\">\r\n\t\t\t// \t    \t<button onClick={handlePrevPost}>&lt;</button>\r\n\t\t\t// \t    \t<button onClick={handleNextPost}>&gt;</button>\r\n\t\t\t// \t    </div>\r\n\t\t\t//     )}\r\n\t\t\t//     <div className=\"post-content\">\r\n\t\t\t//       {popupPosts[currentPostIndex] && (\r\n\t\t\t//         \t<div>\r\n\t\t\t//           \t\t<h3>{popupPosts[currentPostIndex].title}</h3>\r\n\t\t\t//           \t\t<p>{popupPosts[currentPostIndex].description}</p>\r\n\t\t\t//           \t\t{/* Render other post details */}\r\n\t\t\t//         \t</div>\r\n\t\t\t//        )}\r\n\t\t\t//     </div>\r\n\t\t  \t// </div>"],"mappings":"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"},"metadata":{},"sourceType":"module"}